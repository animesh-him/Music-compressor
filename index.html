<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>MP3 Compressor</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/lamejs/1.2.1/lame.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

<style>
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  color: white;
  background: linear-gradient(
    270deg,
    #833ab4,
    #fd1d1d,
    #fcb045,
    #833ab4
  );
  background-size: 600% 600%;
  animation: instaFlow 18s ease infinite;
}

@keyframes instaFlow {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

.container {
  max-width: 600px;
  margin: auto;
  padding: 20px;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

h1 {
  text-align: center;
  margin-bottom: 25px;
  font-size: 2.2rem;
  text-shadow: 0 4px 8px rgba(0,0,0,0.3);
}

.drop-zone {
  border: 3px dashed rgba(255,255,255,0.6);
  border-radius: 18px;
  padding: 35px 20px;
  text-align: center;
  background: rgba(255,255,255,0.12);
  backdrop-filter: blur(10px);
  transition: 0.3s;
}

.drop-zone.dragover {
  background: rgba(255,255,255,0.25);
  transform: scale(1.02);
}

.browse-btn {
  margin-top: 15px;
  padding: 12px 28px;
  border-radius: 25px;
  border: 2px solid white;
  background: rgba(255,255,255,0.15);
  color: white;
  font-weight: 600;
  cursor: pointer;
}

select, button {
  width: 100%;
  margin-top: 18px;
  padding: 14px;
  border-radius: 12px;
  border: none;
  font-size: 1rem;
}

select {
  background: rgba(255,255,255,0.25);
  color: white;
}

option {
  background: #833ab4;
}

button {
  background: linear-gradient(45deg,#ff6b6b,#ff8e8e);
  color: white;
  font-weight: 700;
  cursor: pointer;
}

button:disabled {
  opacity: 0.6;
}

.progress {
  margin-top: 20px;
  display: none;
}

.progress-item {
  margin-bottom: 12px;
  background: rgba(255,255,255,0.15);
  padding: 10px;
  border-radius: 10px;
}

.bar {
  height: 8px;
  background: rgba(255,255,255,0.3);
  border-radius: 5px;
  overflow: hidden;
}

.fill {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg,#4facfe,#00f2fe);
}

.downloads {
  display: none;
  margin-top: 20px;
}

.downloads a, .downloads button {
  margin-top: 10px;
  display: block;
  text-align: center;
  text-decoration: none;
}

.credit {
  margin-top: auto;
  text-align: center;
  padding: 25px 0 10px;
  opacity: 0.9;
}
</style>
</head>

<body>
<div class="container">

<h1>üéµ MP3 Compressor</h1>

<div class="drop-zone" id="dropZone">
  <p>Drag & drop MP3 files here (max 15)</p>
  <button class="browse-btn" id="browseBtn">Choose MP3 Files</button>
  <input type="file" id="fileInput" hidden multiple accept="audio/mp3,audio/mpeg">
</div>

<select id="bitrate">
  <option value="32">32 kbps (Extreme Small)</option>
  <option value="48">48 kbps</option>
  <option value="60" selected>60 kbps (Default)</option>
  <option value="96">96 kbps</option>
  <option value="128">128 kbps</option>
</select>

<button id="startBtn" disabled>üöÄ Start Compression</button>

<div class="progress" id="progress"></div>

<div class="downloads" id="downloads">
  <a id="zipCompressed">üíæ Download Compressed ZIP</a>
  <a id="zipOriginal">üìÅ Download Originals ZIP</a>
  <button onclick="location.reload()">üóëÔ∏è Clear</button>
</div>

<div class="credit">Created by Animesh</div>

</div>

<script>
const fileInput = document.getElementById("fileInput");
const browseBtn = document.getElementById("browseBtn");
const startBtn = document.getElementById("startBtn");
const progressBox = document.getElementById("progress");
const downloads = document.getElementById("downloads");

let files = [];
let compressed = [];

browseBtn.onclick = () => fileInput.click();

fileInput.onchange = () => {
  files = [...fileInput.files].slice(0,15);
  progressBox.innerHTML = "";
  files.forEach((f,i)=>{
    progressBox.innerHTML += `
      <div class="progress-item">
        ${f.name}
        <div class="bar"><div class="fill" id="fill${i}"></div></div>
      </div>`;
  });
  progressBox.style.display = "block";
  startBtn.disabled = files.length === 0;
};

startBtn.onclick = async () => {
  startBtn.disabled = true;
  const bitrate = +document.getElementById("bitrate").value;
  compressed = [];

  for(let i=0;i<files.length;i++){
    compressed[i] = await compress(files[i], bitrate, i);
  }

  prepareZip();
};

async function compress(file, kbps, index) {
  const buffer = await file.arrayBuffer();
  const ctx = new AudioContext({sampleRate:22050});
  const audio = await ctx.decodeAudioData(buffer);
  const samples = audio.getChannelData(0);

  const encoder = new lamejs.Mp3Encoder(1,22050,kbps);
  const block = 1152;
  let mp3 = [];

  for(let i=0;i<samples.length;i+=block){
    const chunk = samples.subarray(i,i+block);
    const pcm = new Int16Array(chunk.length);
    for(let j=0;j<chunk.length;j++){
      pcm[j]=Math.max(-32768,Math.min(32767,chunk[j]*32768));
    }
    const buf = encoder.encodeBuffer(pcm);
    if(buf.length) mp3.push(buf);
    document.getElementById("fill"+index).style.width =
      (i/samples.length*100).toFixed(1)+"%";
  }

  mp3.push(encoder.flush());
  return new Blob(mp3,{type:"audio/mp3"});
}

function prepareZip(){
  const zip1 = new JSZip();
  const zip2 = new JSZip();

  files.forEach((f,i)=>{
    zip1.file(f.name.replace(".mp3","_compressed.mp3"), compressed[i]);
    zip2.file(f.name, f);
  });

  zip1.generateAsync({type:"blob"}).then(b=>{
    zipCompressed.href = URL.createObjectURL(b);
    zipCompressed.download = "compressed.zip";
  });

  zip2.generateAsync({type:"blob"}).then(b=>{
    zipOriginal.href = URL.createObjectURL(b);
    zipOriginal.download = "originals.zip";
  });

  downloads.style.display = "block";
}
</script>
</body>
</html>
